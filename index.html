<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    integrity="sha256-MBffSnbbXwHCuZtgPYiwMQbfE7z+GOZ7fBPCNB06Z98=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.6/css/dataTables.bootstrap5.min.css"
    integrity="sha256-r1NZumaXnbOkpSruGcNONO/6U0qAdSLIeAS7kiUeCA8=" crossorigin="anonymous">
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/datatables.net-responsive-bs5@2.5.0/css/responsive.bootstrap5.min.css"
    integrity="sha256-75sSe7c93rSP2tffrQBjkCzGYDwrWirKdrWzIRa4wGc=" crossorigin="anonymous">

  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/datatables.net-searchpanes-bs5@2.2.0/css/searchPanes.bootstrap5.min.css"
    integrity="sha256-sPt6kCn9d582NiLO/gJnPzqH0HwGgjcv+jbyjzh/HJ4=" crossorigin="anonymous">
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/datatables.net-select-bs5@1.7.0/css/select.bootstrap5.min.css"
    integrity="sha256-CO9fJ5o9p5girfXod33w+qcIRTBPePrxtX5dq7wtnw8=" crossorigin="anonymous">

  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css"
    crossorigin="anonymous">
</head>

<body>
  <div class="container py-5">
    <div class="row">
      <div class="col-md-12 text-center mb-4">
        <h1>College Predictor</h1>
      </div>
      <div class="col-md-6 mb-4">
        <label for="my-rank" class="form-label fw-bold">Enter your rank</label>
        <input type="text" class="form-control" placeholder="Enter your rank" id="my-rank" />
      </div>
      <div class="col-12">
        <table id="table" class="table table-bordered table-striped table-hover">
          <thead>
            <tr>
              <th>SL No</th>
              <th>Code</th>
              <th>District</th>
              <th>College Name</th>
              <th>Course</th>
              <th>Category</th>
              <th>1st Round Rank</th>
              <th>Chance</th>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </div>

  <!-- jQuery, Bootstrap, DataTables, and Responsive extension JS files -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
    integrity="sha256-YMa+wAM6QkVyz999odX7lPRxkoYAan8suedu4k2Zur8=" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js"
    integrity="sha256-gg7eMj/+Pgc2YxkBK4neig9hE5MGpZGUL/QWlGXHKSI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.6/js/dataTables.bootstrap5.min.js"
    integrity="sha256-u2kP0BrkAUxorzBPuW9nh3TKCtaXXSD3VY6/gxvUJig=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/datatables.net-responsive@2.5.0/js/dataTables.responsive.min.js"
    integrity="sha256-LLmmrr9hYXrjHj5w9Q2Asxvom2ErkK3bWcnZ3bdQ5lE=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/datatables.net-responsive-bs5@2.5.0/js/responsive.bootstrap5.min.js"
    integrity="sha256-fxJmiDt8K09elieA/J28vsEvSsmFgGUvoLsEgH/uUx4=" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/datatables.net-searchpanes@2.2.0/js/dataTables.searchPanes.min.js"
    integrity="sha256-R8xUcGU/J7n1vb9fgC5z2g+njjFL8fTZzc+tUNZhCH4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/datatables.net-searchpanes-bs5@2.2.0/js/searchPanes.bootstrap5.min.js"
    integrity="sha256-9uQN0s3heZ52UI1pZyYJj+QQ5kkiqAf9eTTeUZ5xRUc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/datatables.net-select@1.7.0/js/dataTables.select.min.js"
    integrity="sha256-ms96HgFjshKOQE9fFJ0hlgVRPCz12SZRQF4kIlSD6UQ=" crossorigin="anonymous"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/datatables.net-select-bs5@1.7.0/js/select.bootstrap5.min.js" integrity="sha256-sZoItmhYMx6Hw9IfHO6rrNjuhgtKnQzB/ECM1Fql8WI=" crossorigin="anonymous"></script> -->

  <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

  <script>
    $(document).ready(function () {

      function padWithLeadingZeros(num, totalLength) {
        return String(num).padStart(totalLength, '0');
      }

      const uniqueWords = []

      const table = $('#table').DataTable({
        responsive: true,
        ajax: {
          url: 'dcet_2023.json',
          dataSrc: '',
          cache: true,
        },
        dom: 'Bfrtip',
        buttons: [
          'copy', 'csv', 'excel', 'print',
          {
            extend: 'pdf',
            text: 'Export PDF',
            filename: function () {
              return 'COLLEGE_CHANCE_FOR_' + document.querySelector('#my-rank').value || 'Enter Your Rank'
            },
            exportOptions: {
              modifier: {
                page: 'all'
              }
            }
          }
        ],
        stateSave: true,
        searchPanes: {
          // "viewTotal": true,
          columns: [2, 3, 4, 5],
        },
        columns: [
          {
            data: null,
            render: function (data, type, row, meta) {
              return meta.row + 1;
            }
          },
          { data: 'college_code' },
          {
            data: null,
            render: function (data, type, row) {
              // Predict karnataka district from college name
              const college_name = row.college_name;

              const cities = [
                'Bagalkot',
                'Ballari',
                'Bellary',
                'Bangalore',
                'Belagavi',
                'Belgaum',
                'Bengaluru',
                'Bidar',
                'Bhatkala',
                'Chamarajanagar',
                'Chickballapur',
                'Chickkaballapur',
                'Chikkaballapura',
                'Chikkamagaluru',
                'Chitradurga',
                'Dakshina Kannada',
                'Davanagere',
                'Dharwad',
                'Gadag',
                'Hassan',
                'Haveri',
                'Hubli',
                'Kalaburagi',
                'Kalburgi',
                'Kodagu',
                'Kolar',
                'Koppal',
                'Mandya',
                'Mangaluru',
                'Mangalore',
                'Mysore',
                'Mysuru',
                'Raichur',
                'Ramanagara',
                'Shivamogga',
                'Tiptur',
                'Tumakuru',
                'Tumkur',
                'Udupi',
                'Uttara Kannada',
                'Vijayapura',
                'Yadgir',
                "Adhichunchanagiri",
                "Ban/'lore",
                "Bhalki",
                "Bellari",
                "Bidadi",
                "Bijapur",
                "Chickmagalur",
                "Davangere",
                "Dharward",
                "Gangavathi",
                "Gulbarga",
                "Hubballi",
                "Hulkoti",
                "Moodabidri",
                "Moodbidri",
                "Raihcur",
                "Ramanagar-Dist",
                "Ranebennur",
                "Shimoga",
                "Sullia",
                "Taralabalu",
                "Viprasainagar",
                "Yadigir",
                "vijayapur",
              ]

              // cities = [
              //   {
              //     "name": "Bagalkot",
              //     "also_known_as": ["Bagalkot", "Bagalkote"]
              //   },
              //   {
              //     "name": "Ballari",
              //     "also_known_as": ["Ballari", "Bellary"]
              //   },
              //   {
              //     "name": "Belagavi",
              //     "also_known_as": ["Belagavi", "Belgaum"]
              //   },
              //   {
              //     "name": "Bengaluru Rural",
              //     "also_known_as": ["Bengaluru Rural", "Bangalore Rural"]
              //   },
              //   {
              //     "name": "Bengaluru Urban",
              //     "also_known_as": ["Bengaluru Urban", "Bangalore Urban", "Bengaluru", "Bangalore"]
              //   },
              //   {
              //     "name": "Bidar",
              //     "also_known_as": ["Bidar"]
              //   },
              //   {
              //     "name": "Chamarajanagar",
              //     "also_known_as": ["Chamarajanagar"]
              //   },
              //   {
              //     "name": "Chikkaballapur",
              //     "also_known_as": ["Chikkaballapur"]
              //   },
              //   {
              //     "name": "Chikkamagaluru",
              //     "also_known_as": ["Chikkamagaluru"]
              //   },
              //   {
              //     "name": "Chitradurga",
              //     "also_known_as": ["Chitradurga"]
              //   },
              //   {
              //     "name": "Dakshina Kannada",
              //     "also_known_as": ["Dakshina Kannada", "Mangalore"]
              //   },
              //   {
              //     "name": "Davanagere",
              //     "also_known_as": ["Davanagere"]
              //   },
              //   {
              //     "name": "Dharwad",
              //     "also_known_as": ["Dharwad"]
              //   },
              //   {
              //     "name": "Gadag",
              //     "also_known_as": ["Gadag"]
              //   },
              //   {
              //     "name": "Hassan",
              //     "also_known_as": ["Hassan"]
              //   },
              //   {
              //     "name": "Haveri",
              //     "also_known_as": ["Haveri"]
              //   },
              //   {
              //     "name": "Kalaburagi",
              //     "also_known_as": ["Kalaburagi", "Gulbarga"]
              //   },
              //   {
              //     "name": "Kodagu",
              //     "also_known_as": ["Kodagu", "Coorg"]
              //   },
              //   {
              //     "name": "Kolar",
              //     "also_known_as": ["Kolar"]
              //   },
              //   {
              //     "name": "Koppal",
              //     "also_known_as": ["Koppal"]
              //   },
              //   {
              //     "name": "Mandya",
              //     "also_known_as": ["Mandya"]
              //   },
              //   {
              //     "name": "Mysuru",
              //     "also_known_as": ["Mysuru", "Mysore"]
              //   },
              //   {
              //     "name": "Raichur",
              //     "also_known_as": ["Raichur"]
              //   },
              //   {
              //     "name": "Ramanagara",
              //     "also_known_as": ["Ramanagara"]
              //   },
              //   {
              //     "name": "Shivamogga",
              //     "also_known_as": ["Shivamogga", "Shimoga"]
              //   },
              //   {
              //     "name": "Tumakuru",
              //     "also_known_as": ["Tumakuru", "Tumkur"]
              //   },
              //   {
              //     "name": "Udupi",
              //     "also_known_as": ["Udupi"]
              //   },
              //   {
              //     "name": "Uttara Kannada",
              //     "also_known_as": ["Uttara Kannada", "Karwar"]
              //   },
              //   {
              //     "name": "Vijayapura",
              //     "also_known_as": ["Vijayapura", "Bijapur"]
              //   },
              //   {
              //     "name": "Yadgir",
              //     "also_known_as": ["Yadgir"]
              //   }
              // ]

              // match college name with karnataka districts and return district name, if not found return 'Other'

              // Object.keys(cities).forEach(key => {
              //   city = cities[key];

              //   // replace , and - by space
              //   const matched_city = city.also_known_as.find(city => college_name.toLowerCase().replace(/,/g, ' ').replace(/-/g, ' ').includes(city.toLowerCase()));
              //   // const matched_city = city.also_known_as.find(city => college_name.toLowerCase().includes(city.toLowerCase()));
              //   if (matched_city) {
              //     return matched_city;
              //   } else {
              //     uniqueWords.push(college_name);
              //     console.log(college_name);
              //     return 'Other';
              //   }
              // });

              const matched_city = cities.find(city => college_name.toLowerCase().includes(city.toLowerCase()));
              if (matched_city) {
                return matched_city;
              } else {
                uniqueWords.push(college_name);
                console.log(college_name);
                return 'Other';
              }
              return matched_city || 'Other';
            }
          },
          { data: 'college_name' },
          { data: 'course' },
          { data: 'category' },
          {
            data: null,
            render: function (data, type, row) {
              if (row.rank > 0) {

                return padWithLeadingZeros(row.rank, 5)
              }
              return row.rank
            }
          },
          {
            data: null,
            "type": "html-num-fmt",
            render: function (data, type, row) {
              const rank = Number.parseInt(row.rank) || 0;
              const myRank = document.querySelector('#my-rank');
              const myRankValue = myRank.value || "Enter Your Rank";
              console.log(myRankValue)

              if (myRankValue == "Enter Your Rank") {
                return `<span class="badge bg-secondary">Enter Your Rank</span>`;
              }

              // let chance_percent = (Math.min(rank / myRankValue * 100, 99 + Math.random(1, 5))).toFixed(2);
              let chance_percent = padWithLeadingZeros((rank / myRankValue * 100).toFixed(2), 3);
              let badge_color =
                chance_percent > 90 ? 'success'
                  : chance_percent > 80 ? 'primary'
                    : chance_percent > 70 ? 'warning'
                      : 'danger';

              if (chance_percent == 0) {
                return `<span class="badge text-bg-secondary">Not Sure</span>`;
              }

              return `<span class="badge text-bg-${badge_color}">${chance_percent}%</span>`;

            },
          },
        ],
      });

      table.searchPanes.container().prependTo(table.table().container());
      table.searchPanes.resizePanes();

      table.on('xhr', function () {
        const data = table.ajax.json();
        localStorage.setItem('finalData', JSON.stringify(data));
      });

      // table.on('draw', function () {

      // // unqiue words need to replace , by space and remove duplicates
      // const uniqueWordsWithoutComma = uniqueWords.map(word => word.replace(/,/g, ' '));
      // const splitedWords =  [

      // ]
      // uniqueWordsWithoutComma.forEach(word => {
      //   splitedWords.push(...word.split(' '));
      // });

      // // filter out words with length less than 4 and if must be repeated more than 2 times
      // const filteredWords = splitedWords.filter(word => word.length > 4 && splitedWords.filter(w => w === word).length > 2);

      // // remove duplicates
      // const uniqueFilteredWords = [...new Set(filteredWords)];

      // // sort words by alphabets
      // const sortedWords = uniqueFilteredWords.sort();

      // console.log(sortedWords);



      // });



      $('#my-rank').on('input', function () {
        let debounceTimer;
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
          table.ajax.reload();
        }, 500);
      });
    });
  </script>

</body>

</html>